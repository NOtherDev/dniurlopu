!function(a){a.deparam=function(b,c){var d={},e={"true":!0,"false":!1,"null":null};return a.each(b.replace(/\+/g," ").split("&"),function(b,f){var g,h=f.split("="),i=decodeURIComponent(h[0]),j=d,k=0,l=i.split("]["),m=l.length-1;if(/\[/.test(l[0])&&/\]$/.test(l[m])?(l[m]=l[m].replace(/\]$/,""),l=l.shift().split("[").concat(l),m=l.length-1):m=0,2===h.length)if(g=decodeURIComponent(h[1]),c&&(g=g&&!isNaN(g)?+g:"undefined"===g?void 0:void 0!==e[g]?e[g]:g),m)for(;m>=k;k++)i=""===l[k]?j.length:l[k],j=j[i]=m>k?j[i]||(l[k+1]&&isNaN(l[k+1])?{}:[]):g;else a.isArray(d[i])?d[i].push(g):d[i]=void 0!==d[i]?[d[i],g]:g;else i&&(d[i]=c?void 0:"")}),d}}(jQuery),window.DniUrlopu={},DniUrlopu.ResultAccumulator=function(){this.laws=[]};var dateSerializeFormat="YYYYMMDD";DniUrlopu.ResultAccumulator.prototype.serialize=function(){var a=[];$.each(this.laws,function(b,c){a.push(c.act+"."+c.art+"."+(c.par||""))});var b={s:this.started.format(dateSerializeFormat),l:a};return this.schoolHandicap&&(b.sy=this.schoolHandicap.years,this.schoolHandicap.finished&&(b.sf=this.schoolHandicap.finished.format(dateSerializeFormat))),encodeURIComponent($.param(b))},DniUrlopu.ResultAccumulator.deserialize=function(a){var b=$.deparam(decodeURIComponent(a)),c=new DniUrlopu.ResultAccumulator;return c.started=moment(b.s,dateSerializeFormat),$.each(b.l,function(a,b){var d=b.split(".");c.laws.push({act:d[0],art:d[1],par:d[2]})}),b.sy&&(c.schoolHandicap={years:parseInt(b.sy,10)},b.sf&&(c.schoolHandicap.finished=moment(b.sf,dateSerializeFormat))),c},DniUrlopu.Question=function(a){this.data=a},DniUrlopu.Question.prototype.ask=function(a){var b=this,c=Q.defer();_gaq.push(["_trackEvent","Question",this.name]);var d=$('<form class="form-inline question panel-primary bg-primary" action="#">			<span class="question-text">'+this.data.text+"</span>		</form>"),e=function(d,e){d.click(function(){var d=$(this).closest(".opt").find("input, select, textarea").serializeArray(),f={},g=$.extend({},a);b.data.laws&&g.laws.push(b.data.laws);for(var h=0;h<d.length;h++)f[d[h].name]=d[h].value;e&&e(g,f),c.resolve(g)})};d.submit(function(){return!1});for(var f=0;f<this.data.answers.length;f++){var g,h,i=this.data.answers[f];i.html?(h=$('<button class="btn btn-lg btn-info">&gt;</button>'),g=$('<div class="opt opt-complex"></div>').append(i.html).append(h)):h=g=$('<button class="btn btn-lg btn-info opt">'+i.text+"</button>"),e(h,i.whenChosen),d.append(g)}return $("#questions").append(d),d.slideDown("slow"),c.promise},DniUrlopu.Question.prototype.dismiss=function(){$("#questions form").slideUp("slow")},DniUrlopu.Question.prototype.hasEnoughData=function(){return!1},DniUrlopu.Questions={create:function(a,b,c){DniUrlopu.Questions[a]=function(){DniUrlopu.Question.call(this,b),this.name=a},DniUrlopu.Questions[a].prototype=Object.create(DniUrlopu.Question.prototype),DniUrlopu.Questions[a].prototype.constructor=DniUrlopu.Questions[a],$.extend(DniUrlopu.Questions[a].prototype,c)}},DniUrlopu.Calculator=function(a){this.questions=a,this.resAccumulator=new DniUrlopu.ResultAccumulator,this.resultAfterStep=[]},DniUrlopu.Calculator.prototype.calculate=function(){var a=this;!function b(c){a.questions[c].ask(a.resAccumulator).then(function(d){a.resultAfterStep[c]=d,a.resAccumulator=d,a.questions[c].dismiss(),a.questions[c].hasEnoughData(a.resAccumulator)||c+1===a.questions.length?a.finish():b(c+1)}).done()}(0)},DniUrlopu.Calculator.prototype._renderResult=function(){var a=this,b=$("#main-result").empty();$.each([DniUrlopu.ResultRenderer,DniUrlopu.LawsRenderer],function(c,d){new d(a.resAccumulator).renderTo(b)})},DniUrlopu.Calculator.prototype.finish=function(){debug("steps",this.resultAfterStep),_gaq.push(["_trackEvent","Calculator","finish"]),$("#intro").slideUp("slow"),this._renderResult(),$("#signup-data").val(this.resAccumulator.serialize()),$(".result").slideDown("slow")},DniUrlopu.Calculator.prototype.finishWith=function(a){this.resAccumulator=a,$("#intro").hide(),this._renderResult(),$(".result:not(.signup)").show()},function(){"use strict";var a=new Date;DniUrlopu.Questions.create("WorkAgreement",{text:"Pierwszą pracę na umowę o pracę rozpocząłem",laws:{act:"KP",art:154,par:1},answers:[{html:'<input class="form-control" name="day" type="number" min="1" max="31" value="1">          <select class="form-control" name="month">              <option value="0">stycznia</option>              <option value="1">lutego</option>              <option value="2">marca</option>              <option value="3">kwietnia</option>              <option value="4">maja</option>              <option value="5">czerwca</option>              <option value="6">lipca</option>              <option value="7">sierpnia</option>              <option value="8">września</option>              <option value="9">października</option>              <option value="10">listopada</option>              <option value="11">grudnia</option>          </select>          <input class="form-control" name="year" type="number"            min="'+(a.getFullYear()-67)+'" max="'+a.getFullYear()+'" value="2012">',whenChosen:function(b,c){parseInt(c.year)===a.getFullYear()&&(b.firstYear=!0,b.laws.push({act:"KP",art:153,par:1})),b.started=moment([c.year,c.month,c.day])}}]},{hasEnoughData:function(a){return moment().subtract(10,"years")>a.started||moment().subtract(2,"years")<a.started}}),DniUrlopu.Questions.create("EducationType",{text:"Ukończyłem szkołę<br>",laws:{act:"KP",art:155,par:1},answers:[{text:"wyższą (licencjacką, magisterską)",whenChosen:function(a){a.schoolHandicap={years:8}}},{text:"policealną",whenChosen:function(a){a.schoolHandicap={years:6}}},{text:"średnią ogólnokształcącą",whenChosen:function(a){a.schoolHandicap={years:4}}},{text:"średnią zawodową",whenChosen:function(a){a.schoolHandicap={years:5}}},{text:"zasadniczą zawodową",whenChosen:function(a){a.schoolHandicap={years:3}}},{text:"żadną z wymienionych"}]},{hasEnoughData:function(a){if(!a.schoolHandicap)return!0;var b=a.started.clone().subtract(a.schoolHandicap.years,"years");return b>moment().subtract(10,"years")}}),DniUrlopu.Questions.create("EducationFinished",{text:"Szkołę zakończyłem",laws:{act:"KP",art:155,par:2},answers:[{html:'<input class="form-control" name="day" type="number" min="1" max="31" value="1">          <select class="form-control" name="month">              <option value="0">stycznia</option>              <option value="1">lutego</option>              <option value="2">marca</option>              <option value="3">kwietnia</option>              <option value="4">maja</option>              <option value="5">czerwca</option>              <option value="6">lipca</option>              <option value="7">sierpnia</option>              <option value="8">września</option>              <option value="9">października</option>              <option value="10">listopada</option>              <option value="11">grudnia</option>          </select>          <input class="form-control" name="year" type="number"            min="'+(a.getFullYear()-10)+'" max="'+a.getFullYear()+'" value="2012">',whenChosen:function(a,b){a.schoolHandicap.finished=moment([b.year,b.month,b.day])}}]})}(),function(){"use strict";moment.locale("pl",{months:["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"]}),DniUrlopu.LawsRenderer=function(a){this.laws=a.laws},DniUrlopu.LawsRenderer.prototype.format=function(a){if("KP"===a.act){var b="Ustawa z dnia 26 czerwca 1974 r. Kodeks pracy, art. "+a.art;return a.par&&(b+=" § "+a.par),'<a href="http://prawo.money.pl/kodeks/pracy/dzial-siodmy-urlopy-pracownicze/rozdzial-i-urlopy-wypoczynkowe/art-'+a.art+'">'+b+"</a>"}return a},DniUrlopu.LawsRenderer.prototype.renderTo=function(a){var b=this,c=$('<ul class="laws"></ul>');$.each(this.laws,function(a,d){c.append("<li>"+b.format(d)+"</li>")});var d=$('<button class="btn btn-default">Podstawa prawna</button>').click(function(){_gaq.push(["_trackEvent","lawsRendered"]),c.slideToggle("slow")});a.append(d),a.append('<button class="btn btn-info pull-right" id="start-over">Oblicz ponownie</button>'),a.append(c.hide())},DniUrlopu.ResultRenderer=function(a){this.result=a},DniUrlopu.ResultRenderer.prototype.renderTable=function(a){if(!a||!a.length)return"";var b="";return $.each(a,function(a,c){b+='<tr><td class="date">'+c.from+"</td><td>"+c.days+" dni</td></tr>"}),'<table class="table table-hover"><thead><tr><th>Od dnia</th><th>Przysługujący wymiar urlopu</th></tr></thead><tbody>'+b+"</tbody></table>"};var a=function(a){return parseFloat(a.toFixed(2))};DniUrlopu.ResultRenderer.prototype.renderTo=function(b){debug("finished",this.result),b.append("<p>W roku "+moment().year()+" przysługuje Ci</p>");var c=this.result.started.clone(),d=[];if(this.result.firstYear){var e=this.result.started.clone().add(1,"year").startOf("year"),f=0,g=20/12;for(c.add(1,"month");e>c;)f+=g,d.push({from:c.format("D MMMM"),days:a(f)}),c.add(1,"month");b.append('<p class="heading">łącznie <span class="number">'+a(f)+"</span> dni urlopu</p>"),b.append(this.renderTable(d)),c.isSame(e,"day")&&b.append('<p>Ponadto, na dzień <span class="date">1 stycznia '+e.year()+'</span> będzie przysługiwać Ci <span class="number">'+a(g)+"</span> dnia urlopu zaległego.</p>")}else{if(this.result.schoolHandicap){if(this.result.schoolHandicap.finished){var h=this.result.schoolHandicap.finished.clone();h.clone().subtract(this.result.schoolHandicap.years,"years")<c&&(c=moment.max(c,h))}c.subtract(this.result.schoolHandicap.years,"years")}c.add(10,"years");var i=c.year(),j=i>moment().year()?20:26;b.append('<p class="heading"><span class="number">'+j+"</span> dni urlopu</p>"),i!==moment().year()||c.isSame(moment().startOf("year"),"day")||(this.result.laws.push({act:"KP",art:158}),d=[{from:"1 stycznia",days:20},{from:c.format("D MMMM"),days:26}],b.append(this.renderTable(d)))}window.getUrlParameter("d")?$(".signup").hide():$("#signup-data").val(this.result.serialize())}}(),function(){"use strict";window.debug=function(){"localhost"===window.location.hostname&&console.debug.apply(console,arguments)},window.getUrlParameter=function(a){return(new RegExp(a+"=(.+?)(&|$)").exec(window.location.search)||[,null])[1]};var a=function(){var a=new DniUrlopu.Calculator([new DniUrlopu.Questions.WorkAgreement,new DniUrlopu.Questions.EducationType,new DniUrlopu.Questions.EducationFinished]),b=window.getUrlParameter("d");b?(_gaq.push(["_trackEvent","deserialize"]),a.finishWith(DniUrlopu.ResultAccumulator.deserialize(b))):a.calculate()};$(document).ready(function(){$("#main-result").on("click","#start-over",function(){return _gaq.push(["_trackEvent","startOver"]),window.getUrlParameter("d")?void(location.href="/"):($(".result").slideUp("slow"),$("#intro").slideDown("slow"),a(),void 0)})}),a()}();